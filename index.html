<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Yes Passed ‚Äì Cat B Mock Theory Test</title>
<style>
  :root{
    --brand:#19b36b; --brand-dark:#128b53; --bg:#0b0f14; --card:#111823;
    --text:#e8f1f0; --muted:#9fb3ad; --accent:#ffbf3f; --danger:#ff5d5d;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#0b0f14,#0e141d 60%);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif}
  header{position:sticky;top:0;z-index:10;background:rgba(17,24,35,.9);backdrop-filter:blur(8px);border-bottom:1px solid #1e2a3b}
  .wrap{max-width:980px;margin:0 auto;padding:16px}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:36px;height:36px;border-radius:8px;background:var(--brand);display:grid;place-items:center;color:#04140d;font-weight:800}
  h1{margin:0;font-size:clamp(1.2rem,2.4vw,1.6rem)}
  .meta{display:flex;gap:12px;flex-wrap:wrap;margin-top:6px;color:var(--muted);font-size:.92rem}
  main{padding:16px}
  .grid{display:grid;grid-template-columns:1fr;gap:16px}
  @media(min-width:980px){.grid{grid-template-columns:1fr 300px}}
  .card{background:var(--card);border:1px solid #1e2a3b;border-radius:16px;padding:16px}
  .qhead{display:flex;justify-content:space-between;align-items:end;gap:12px}
  .timer{font-variant-numeric:tabular-nums}
  .progress{height:10px;background:#122031;border-radius:999px;overflow:hidden;border:1px solid #1e2a3b}
  .progress>div{height:100%;background:linear-gradient(90deg,var(--brand),#5bebaa);width:0%}
  .qimg{display:block;width:100%;max-height:230px;object-fit:contain;background:#0c1320;border:1px solid #223248;border-radius:12px;padding:8px;margin:12px 0}
  .qtext{font-size:1.05rem;font-weight:600;margin:8px 0}
  .answers{display:grid;gap:10px;margin-top:8px}
  .answer{display:flex;align-items:center;gap:10px;border:1px solid #223248;background:#0f1622;border-radius:12px;padding:10px;cursor:pointer;transition:transform .05s}
  .answer input{accent-color:var(--brand)}
  .answer:active{transform:scale(.995)}
  .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  .btn{appearance:none;border:0;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
  .ghost{background:transparent;border:1px solid #2a3a52;color:var(--text)}
  .primary{background:var(--brand);color:#04140d}
  .primary:hover{background:var(--brand-dark)}
  .review{display:grid;grid-template-columns:repeat(auto-fill,minmax(38px,1fr));gap:8px}
  .review button{padding:8px;border-radius:10px;border:1px solid #27384f;background:#0e1724;color:var(--text);font-variant-numeric:tabular-nums}
  .review button.answered{background:#122b1f;border-color:#1e5a3b}
  .hidden{display:none}
  /* Results & share */
  #results .shareCard{background:var(--brand);color:#04140d;border-radius:18px;padding:18px;margin:12px 0;box-shadow:0 10px 30px rgba(0,0,0,.25)}
  .shareHeader{display:flex;align-items:center;gap:10px;margin-bottom:6px}
  .shareLogo{width:36px;height:36px;border-radius:10px;background:#04140d;color:var(--brand);display:grid;place-items:center;font-weight:800}
  .shareRow{display:flex;gap:10px;flex-wrap:wrap}
  .pill{padding:6px 10px;border-radius:999px;background:#0c271b;color:#b7f0d2;border:1px solid #0e3a25}
  .shareBtns{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  details{margin-top:14px}
  summary{cursor:pointer}
  .inc-list li{margin-bottom:14px}
  .inc-q{font-weight:700}
  .inc-correct{color:#9cf0c6}
  .inc-expl{color:#bfe7d6}
  footer{color:var(--muted);text-align:center;margin:30px 0}
</style>
</head>
<body>
<header>
  <div class="wrap brand">
    <div class="logo">YP</div>
    <div>
      <h1>Yes Passed ‚Äì Cat B Mock Theory Test</h1>
      <div class="meta"><span>50 Questions</span><span>57:00 limit</span><span>Pass: 43</span></div>
    </div>
  </div>
</header>

<main class="wrap grid" id="app">
  <section class="card">
    <div class="qhead">
      <div>Question <span id="qNo">1</span> / 50</div>
      <div class="timer" id="timer">57:00</div>
    </div>
    <div class="progress" aria-hidden="true"><div id="progressBar"></div></div>
    <img id="qImg" class="qimg" alt="Question illustration" />
    <div class="qtext" id="qText">Loading‚Ä¶</div>
    <div class="answers" id="answers"></div>
    <div class="controls">
      <button class="btn ghost" id="prevBtn">‚Üê Prev</button>
      <button class="btn ghost" id="nextBtn">Next ‚Üí</button>
      <button class="btn primary" id="submitBtn">Submit</button>
    </div>
  </section>

  <aside class="card">
    <h3 style="margin-top:0">Review</h3>
    <p class="muted" style="margin-top:-6px;color:var(--muted)">Jump to any question.</p>
    <div class="review" id="review"></div>
  </aside>
</main>

<section class="wrap card hidden" id="results">
  <h2 style="margin-top:0">Results</h2>
  <p id="summary"></p>

  <div id="shareCard" class="shareCard">
    <div class="shareHeader">
      <div class="shareLogo">YP</div>
      <div style="font-weight:800">Yes Passed ‚Äì Cat B Mock Theory Test</div>
    </div>
    <div class="shareRow">
      <span class="pill" id="shareDate"></span>
      <span class="pill" id="shareTimeTaken"></span>
      <span class="pill" id="shareScore"></span>
      <span class="pill" id="shareOutcome"></span>
    </div>
    <p style="margin:10px 0 0"><strong>Yes Passed Driving Academy</strong><br><em>Built for Growth. Driven by Learning.</em></p>
    <div class="shareBtns">
      <button id="fbShare" class="btn ghost">Share on Facebook</button>
      <button id="copyShare" class="btn ghost">Copy Result</button>
      <button id="saveImg" class="btn ghost">Save as Image</button>
    </div>
  </div>

  <details open>
    <summary><strong>Review your incorrect questions</strong></summary>
    <ol id="incorrectList" class="inc-list"></ol>
  </details>

  <div class="controls" style="margin-top:12px">
    <button id="restart" class="btn primary">Restart Test</button>
  </div>
</section>

<footer>
  üíö <strong>Yes Passed Driving Academy</strong> ‚Äî Built for Growth. Driven by Learning.
</footer>

<!-- html2canvas for share card image -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js" crossorigin="anonymous"></script>

<script>
// ===== Config =====
const TOTAL = 50;
const PASS = 43;
const DURATION_SECONDS = 57*60; // 57 minutes
const SHARE_URL = "https://www.facebook.com/yespassed";

// ===== Questions: each has an image (Wikimedia signs + Unsplash scenarios). =====
// Note: Unsplash URLs include sizing parameters for quick loads; all links are HTTPS.
const QUESTIONS = [
  // --- Road signs (Wikimedia) ---
  {q:"What does this sign mean?", img:"https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/UK_traffic_sign_616.svg/200px-UK_traffic_sign_616.svg.png", a:["No entry","No stopping","Stop","Give way"], c:0, e:"Red circle with white bar = ‚ÄòNo entry‚Äô to all vehicles."},
  {q:"What does this sign mean?", img:"https://upload.wikimedia.org/wikipedia/commons/thumb/9/9e/UK_traffic_sign_602.svg/200px-UK_traffic_sign_602.svg.png", a:["Give way","Stop","No vehicles","No entry"], c:0, e:"Inverted triangle with red border = ‚ÄòGive Way‚Äô. Yield to major road traffic."},
  {q:"What does this sign mean?", img:"https://upload.wikimedia.org/wikipedia/commons/thumb/6/6a/UK_traffic_sign_567.svg/200px-UK_traffic_sign_567.svg.png", a:["Humpback bridge or road hump","Bridge ahead","Tunnel","Ford"], c:0, e:"Humped shape warns of a humpback bridge/road hump ‚Äî slow down."},
  {q:"What does this sign mean?", img:"https://upload.wikimedia.org/wikipedia/commons/thumb/e/e5/UK_traffic_sign_554.2.svg/200px-UK_traffic_sign_554.2.svg.png", a:["Slippery road","Loose chippings","Steep hill","Ford"], c:0, e:"Car with skid marks = slippery surface especially when wet/icy."},
  {q:"What does this sign mean?", img:"https://upload.wikimedia.org/wikipedia/commons/thumb/5/5b/UK_traffic_sign_610.svg/200px-UK_traffic_sign_610.svg.png", a:["National speed limit applies","End of 30 mph","No waiting","No stopping"], c:0, e:"Black diagonal stripe on white = national speed limit applies."},
  {q:"What does this sign mean?", img:"https://upload.wikimedia.org/wikipedia/commons/thumb/2/27/UK_traffic_sign_512.svg/200px-UK_traffic_sign_512.svg.png", a:["Road narrows both sides","End of dual carriageway","Uneven road","Road closed"], c:0, e:"Edges converging show ‚ÄòRoad narrows on both sides‚Äô."},
  {q:"What does this sign mean?", img:"https://upload.wikimedia.org/wikipedia/commons/thumb/2/29/UK_traffic_sign_552.svg/200px-UK_traffic_sign_552.svg.png", a:["Wild animals crossing","Cattle crossing","Farm traffic only","Zoo ahead"], c:0, e:"Deer symbol = wild animals may cross."},
  {q:"What does this sign mean?", img:"https://upload.wikimedia.org/wikipedia/commons/thumb/1/1e/UK_traffic_sign_601.1.svg/200px-UK_traffic_sign_601.1.svg.png", a:["No motor vehicles","No buses","Cars and bikes only","Bus & cycle lane"], c:0, e:"Motorcycle above car in a red circle = ‚ÄòNo motor vehicles‚Äô."},
  {q:"What does this sign mean?", img:"https://upload.wikimedia.org/wikipedia/commons/thumb/1/1b/UK_traffic_sign_611.svg/200px-UK_traffic_sign_611.svg.png", a:["No waiting","No stopping","Clearway ends","One way"], c:0, e:"Blue circle with single red slash = ‚ÄòNo waiting‚Äô (two slashes = ‚ÄòNo stopping‚Äô)."},
  {q:"What does this sign mean?", img:"https://upload.wikimedia.org/wikipedia/commons/thumb/c/cf/UK_traffic_sign_816.svg/200px-UK_traffic_sign_816.svg.png", a:["Traffic enforcement cameras","Tourist attraction","Average speed ends","Bus lane camera only"], c:0, e:"Camera symbol warns that enforcement cameras may operate."},
  {q:"What does this sign mean?", img:"https://upload.wikimedia.org/wikipedia/commons/thumb/b/b8/UK_traffic_sign_606.svg/200px-UK_traffic_sign_606.svg.png", a:["Turn left (mandatory)","No left turn","Keep left","Give way to left"], c:0, e:"Blue circular arrow signs are mandatory directions ‚Äî ‚ÄòTurn left‚Äô here."},
  {q:"What does this sign mean?", img:"https://upload.wikimedia.org/wikipedia/commons/thumb/0/0a/UK_traffic_sign_642.svg/200px-UK_traffic_sign_642.svg.png", a:["No overtaking","Contraflow","Overtaking lane ahead","Priority over oncoming"], c:0, e:"Red circle with two cars (black passing red) = ‚ÄòNo overtaking‚Äô."},
  {q:"What does this sign mean?", img:"https://upload.wikimedia.org/wikipedia/commons/thumb/1/10/UK_traffic_sign_547.svg/200px-UK_traffic_sign_547.svg.png", a:["Two-way traffic","Dual carriageway ahead","Contraflow starts","One-way street"], c:0, e:"Vertical arrows in opposite directions = two-way traffic."},
  {q:"What does this sign mean?", img:"https://upload.wikimedia.org/wikipedia/commons/thumb/f/f1/UK_traffic_sign_547.4.svg/200px-UK_traffic_sign_547.4.svg.png", a:["Priority over oncoming traffic","Give way to oncoming","Two-way road","No entry"], c:0, e:"White upward arrow with smaller red down arrow = you have priority."},
  {q:"What does this sign mean?", img:"https://upload.wikimedia.org/wikipedia/commons/thumb/2/2a/UK_traffic_sign_520.svg/200px-UK_traffic_sign_520.svg.png", a:["Traffic signals ahead","Level crossing ahead","Speed camera ahead","Tunnel"], c:0, e:"Signal heads in triangle = traffic signals ahead."},

  // --- Scenarios (Unsplash) ---
  {q:"At a zebra crossing with zigzag lines, what must you do?", img:"https://images.unsplash.com/photo-1508599589920-14cfa1c1fe4b?q=80&w=1200&auto=format&fit=crop", a:["Stop to load briefly","Avoid overtaking or parking","Sound your horn","Use hazard lights"], c:1, e:"Zigzags mean no stopping, parking or overtaking to keep sight lines clear."},
  {q:"A green filter arrow shows at traffic lights. You should:", img:"https://images.unsplash.com/photo-1589927986089-35812388d1d9?q=80&w=1200&auto=format&fit=crop", a:["Proceed in that direction if the junction is clear","Proceed regardless","Stop and wait","Give way to vehicles on your left only"], c:0, e:"A green filter arrow allows you to go in that direction if the way is clear."},
  {q:"‚ÄòExcept for access‚Äô below a restriction means:", img:"https://images.unsplash.com/photo-1563720223185-11003d5163a5?q=80&w=1200&auto=format&fit=crop", a:["Residents only","Vehicles may enter only to reach premises inside","Loading only","Buses only"], c:1, e:"You can pass the restriction solely to access premises within ‚Äî not as a through-route."},
  {q:"On a smart motorway a red X shows over your lane. You should:", img:"https://images.unsplash.com/photo-1480666140674-b6c0f4f2b4ae?q=80&w=1200&auto=format&fit=crop", a:["Reduce speed","Leave the lane safely ‚Äî it‚Äôs closed","Hard shoulder only","Ignore if traffic is light"], c:1, e:"A red X means the lane is closed. Leave it safely and promptly."},
  {q:"At a pelican crossing with flashing amber, you should:", img:"https://images.unsplash.com/photo-1565514158740-064f34bd6c19?q=80&w=1200&auto=format&fit=crop", a:["Stop and wait for green","Proceed if the crossing is clear","Sound your horn","Speed up to clear"], c:1, e:"Flashing amber allows you to go if the crossing is clear; give way to pedestrians still crossing."},
  {q:"Following a large vehicle in rain, you should:", img:"https://images.unsplash.com/photo-1503376780353-7e6692767b70?q=80&w=1200&auto=format&fit=crop", a:["Speed up","Increase following distance","Use horn more","Main beam on"], c:1, e:"Spray reduces visibility; increase separation to maintain safe stopping distance."},
  {q:"Turning right at an unmarked crossroads with oncoming traffic, you should:", img:"https://images.unsplash.com/photo-1506521781263-d8422e82f27a?q=80&w=1200&auto=format&fit=crop", a:["Turn in front of oncoming","Turn behind the oncoming vehicle","Force priority","Sound your horn"], c:1, e:"Turn offside-to-offside (behind each other) unless marked otherwise."},
  {q:"National speed limit for cars on a dual carriageway is:", img:"https://images.unsplash.com/photo-1534237710867-4f6c1b2d2d8d?q=80&w=1200&auto=format&fit=crop", a:["70 mph","60 mph","50 mph","40 mph"], c:0, e:"For cars: 70 mph on motorways and dual carriageways unless signed otherwise."},
  {q:"A ball rolls into the road from between parked cars. You should:", img:"https://images.unsplash.com/photo-1465447142348-e9952c393450?q=80&w=1200&auto=format&fit=crop", a:["Maintain speed","Expect a child to follow and be ready to stop","Sound horn and maintain speed","Swerve into opposite lane"], c:1, e:"Expect a child after a ball. Slow immediately and be prepared to stop."},
  {q:"Dazzled by oncoming headlights at night. Do you:", img:"https://images.unsplash.com/photo-1502877338535-766e1452684a?q=80&w=1200&auto=format&fit=crop", a:["Look to the left kerb and slow if needed","Look at the lights","Use main beam","Accelerate past"], c:0, e:"Avoid glare by glancing left to the kerb and reduce speed if necessary."},
  {q:"Front of the queue at red lights; an ambulance approaches behind. You should:", img:"https://images.unsplash.com/photo-1608889335941-7bc01db57a97?q=80&w=1200&auto=format&fit=crop", a:["Go through the red light","Pull into junction and stop","Stay put; don‚Äôt break the law","U-turn immediately"], c:2, e:"Don‚Äôt cross a red light. Move aside legally and safely when possible."},
  {q:"Daytime use of headlights is appropriate:", img:"https://images.unsplash.com/photo-1503376782490-7f83c5f571d4?q=80&w=1200&auto=format&fit=crop", a:["In fog or seriously reduced visibility","Always","Never","Only on rural roads"], c:0, e:"Use dipped headlights in fog/seriously reduced visibility."},
  {q:"Variable speed limit shows on a smart motorway. You should:", img:"https://images.unsplash.com/photo-1541976076758-347942db1971?q=80&w=1200&auto=format&fit=crop", a:["Ignore it","Obey the displayed limit","Stop on the hard shoulder","Only slow if heavy traffic"], c:1, e:"Mandatory variable limits must be obeyed to manage flow and safety."},
  {q:"Left lane but taking the 3rd exit (right) at a roundabout. You should:", img:"https://images.unsplash.com/photo-1520975916090-3105956dac38?q=80&w=1200&auto=format&fit=crop", a:["Stay left anyway","Move right when safe and signal right","Stop and wait","Sound horn to warn"], c:1, e:"Get into the correct lane in good time and signal as appropriate."},
  {q:"On wet roads, typical stopping distances are:", img:"https://images.unsplash.com/photo-1493236296276-d17357e2883b?q=80&w=1200&auto=format&fit=crop", a:["Half normal","Same as dry","Double","One quarter"], c:2, e:"Allow at least double the stopping distance when roads are wet."},
  {q:"Box junction rules mean you must not enter unless:", img:"https://images.unsplash.com/photo-1558981806-ec527fa84c39?q=80&w=1200&auto=format&fit=crop", a:["Turning left","Your exit is clear","It‚Äôs rush hour","Following emergency services"], c:1, e:"Only enter when your exit is clear (except turning right and blocked by oncoming)."},
  {q:"At an unmarked junction, who has priority?", img:"https://images.unsplash.com/photo-1502872364588-894d7d6fd96e?q=80&w=1200&auto=format&fit=crop", a:["Traffic on the right","You do","No one ‚Äî proceed with caution","The largest vehicle"], c:2, e:"No marked priority ‚Äî all proceed cautiously and be prepared to stop."},
  {q:"Towing a trailer on a motorway: max speed for cars is:", img:"https://images.unsplash.com/photo-1517227393670-7f1e9f5d1b5b?q=80&w=1200&auto=format&fit=crop", a:["70 mph","60 mph","50 mph","40 mph"], c:1, e:"Cars with trailers: 60 mph on motorways/dual carriageways unless lower limit applies."},
  {q:"Parking on the road at night:", img:"https://images.unsplash.com/photo-1471478331149-c72f17e33c73?q=80&w=1200&auto=format&fit=crop", a:["Leave full beam on","Park facing traffic","Use parking lights where speed limit exceeds 30 mph","No lights needed"], c:2, e:"Where the limit is over 30 mph, use sidelights when parked at night."},
  {q:"Where are red studs on a motorway?", img:"https://images.unsplash.com/photo-1465447142348-e9952c393450?q=80&w=1200&auto=format&fit=crop", a:["Between lanes","Between hard shoulder and carriageway edge","Between carriageways","At slip roads"], c:1, e:"Red studs mark the left edge between hard shoulder and carriageway."},
  {q:"Safest way to use a sat nav while driving:", img:"https://images.unsplash.com/photo-1549921296-3a6b42df90d5?q=80&w=1200&auto=format&fit=crop", a:["Set it before moving and follow safely","Program while moving","Hold it in your hand","Ignore the route"], c:0, e:"Set guidance before you move; stop safely if adjustments are needed."},
  {q:"Steep downhill ahead. You should:", img:"https://images.unsplash.com/photo-1519098901909-b1553a1329b2?q=80&w=1200&auto=format&fit=crop", a:["Select a lower gear early","Coast in neutral","Use only the handbrake","Switch engine off"], c:0, e:"Use a lower gear for engine braking before the descent."},
  {q:"Joining a motorway from a slip road, you should:", img:"https://images.unsplash.com/photo-1511396275271-a42e5a9d6817?q=80&w=1200&auto=format&fit=crop", a:["Stop at the end","Match speed and merge when safe","Signal after merging","Use hard shoulder first"], c:1, e:"Use the slip road to match speed and merge into a safe gap."},
  {q:"Amber flashing lights on a school bus ahead mean:", img:"https://images.unsplash.com/photo-1536924940846-227afb31e2a5?q=80&w=1200&auto=format&fit=crop", a:["Overtake quickly","Be prepared to stop ‚Äî children may be crossing","Ignore","Sound horn"], c:1, e:"Children may be boarding/alighting; slow and be prepared to stop."},
  {q:"Stud colours: between lanes on a motorway you‚Äôll see:", img:"https://images.unsplash.com/photo-1465447142348-e9952c393450?q=80&w=1200&auto=format&fit=crop", a:["Red","White","Green","Amber"], c:1, e:"White studs separate lanes; red at left edge; amber next to central reservation; green at slip roads."},
  {q:"Large vehicle signals left but moves right first. You should:", img:"https://images.unsplash.com/photo-1517292987719-0369a794ec0f?q=80&w=1200&auto=format&fit=crop", a:["Overtake on the left","Hold back and allow it to turn","Close up","Pass on the right immediately"], c:1, e:"Large vehicles may swing out to turn ‚Äî keep back and give room."},
  {q:"When should you avoid overtaking?", img:"https://images.unsplash.com/photo-1501555088652-021faa106b9b?q=80&w=1200&auto=format&fit=crop", a:["On long straight roads","Just after a bend","Approaching a junction or dip in the road","On motorways"], c:2, e:"Avoid overtaking near junctions, brows, bends or dips where visibility/space is limited."},
  {q:"Approaching a mini-roundabout, you should:", img:"https://images.unsplash.com/photo-1549395156-529c1d053683?q=80&w=1200&auto=format&fit=crop", a:["Approach at speed and assert priority","Slow, look, give way to traffic from the right","Stop unless police present","Use main beam"], c:1, e:"Give way to traffic from the right and proceed carefully around the central marking."},
  {q:"Cyclist in windy conditions. You should:", img:"https://images.unsplash.com/photo-1492684223066-81342ee5ff30?q=80&w=1200&auto=format&fit=crop", a:["Pass closely","Give at least 1.5 m clearance (more at higher speeds)","Sound your horn","Only overtake on bends"], c:1, e:"Give cyclists plenty of room ‚Äî at least 1.5 m at lower speeds."},
  {q:"Visibility less than 100 m in fog. You should:", img:"https://images.unsplash.com/photo-1432839318976-b6c1d336a3ae?q=80&w=1200&auto=format&fit=crop", a:["Use fog lights and main beam","Use dipped headlights and rear fogs if needed","No lights needed","Use hazard lights while driving"], c:1, e:"Use dipped headlights; rear fogs under 100 m visibility; switch off when it improves."},
  {q:"Junction ahead is blocked though your signal is green. You should:", img:"https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=1200&auto=format&fit=crop", a:["Enter and wait","Stop and wait until exit is clear","Sound horn and proceed","Use opposite lane"], c:1, e:"Don‚Äôt enter a junction unless your exit is clear."},
  {q:"Approaching horses on a country lane. You should:", img:"https://images.unsplash.com/photo-1517849845537-4d257902454a?q=80&w=1200&auto=format&fit=crop", a:["Accelerate past quickly","Pass wide and slow","Sound horn to warn","Use main beam"], c:1, e:"Pass horses slow and wide; be prepared to stop if signalled."},
  {q:"You see surface water and spray on a dual carriageway. Best action:", img:"https://images.unsplash.com/photo-1502082553048-f009c37129b9?q=80&w=1200&auto=format&fit=crop", a:["Move closer to vehicle ahead","Increase gap and use dipped headlights","Use hazard lights while moving","Coast in neutral"], c:1, e:"Increase separation; use dipped headlights so others can see you."},
  {q:"You‚Äôre queueing in slow traffic. Keep these clear:", img:"https://images.unsplash.com/photo-1516570161787-2fd917215a3d?q=80&w=1200&auto=format&fit=crop", a:["Bus stops","Box junctions and side roads","Lay-bys","Cycle lanes"], c:1, e:"Do not block box junctions or side roads; leave gaps so traffic can flow."},
  {q:"A pedestrian with a white cane with red band is waiting to cross. They are:", img:"https://images.unsplash.com/photo-1518199266791-5375a83190b7?q=80&w=1200&auto=format&fit=crop", a:["Elderly","Deafblind","Tourist","School crossing patrol"], c:1, e:"A red band on a white cane indicates the person is deafblind."},
  {q:"Your tyre blows out on a motorway. You should:", img:"https://images.unsplash.com/photo-1517677208171-0bc6725a3e60?q=80&w=1200&auto=format&fit=crop", a:["Brake hard immediately","Grip steering firmly, ease off accelerator, allow to slow, stop safely","Accelerate out of trouble","Apply handbrake"], c:1, e:"Hold steering, ease off gently, avoid harsh braking, stop in a safe place."},
  {q:"You‚Äôre first at a level crossing; lights steady amber then flashing red. You should:", img:"https://images.unsplash.com/photo-1523359346063-d879354c0ea5?q=80&w=1200&auto=format&fit=crop", a:["Continue if clear","Stop and wait","Proceed if in a hurry","Reverse"], c:1, e:"Flashing red at crossings = stop and wait until lights stop and barriers open."},
  {q:"You see a ‚ÄòNo through road‚Äô sign. It means:", img:"https://upload.wikimedia.org/wikipedia/commons/thumb/7/76/UK_traffic_sign_816.1.svg/200px-UK_traffic_sign_816.1.svg.png", a:["Dead end","Diversion","One-way","Width restriction"], c:0, e:"Blue ‚ÄòT‚Äô plate indicates a cul-de-sac for vehicles."},
  {q:"Approaching a tramway crossing area in a city. You should:", img:"https://images.unsplash.com/photo-1558980664-10b3b1a4f7b1?q=80&w=1200&auto=format&fit=crop", a:["Expect trams and look for signals and markings","Avoid stopping only at night","Sound horn to warn","Drive on rails for traction"], c:0, e:"Be alert for trams and follow dedicated signals/markings."},
  {q:"You reach a long tunnel. Before entering you should:", img:"https://images.unsplash.com/photo-1505904267569-8f3a3a5a5b1b?q=80&w=1200&auto=format&fit=crop", a:["Remove sunglasses, switch to dipped headlights","Use main beam throughout","Open bonnet","Turn off ventilation"], c:0, e:"Use dipped headlights; remove sunglasses; maintain safe distance."},
  {q:"Approaching a hump bridge with limited view. You should:", img:"https://images.unsplash.com/photo-1482192505345-5655af888cc4?q=80&w=1200&auto=format&fit=crop", a:["Speed up to climb","Slow, keep left and be ready to stop","Sound horn continuously","Overtake slow vehicles"], c:1, e:"Visibility and space are limited ‚Äî slow, keep left, be ready to stop."},
  {q:"Your lane has a red X but the next lane shows a speed limit. Do you:", img:"https://images.unsplash.com/photo-1534531688091-a45825799210?q=80&w=1200&auto=format&fit=crop", a:["Stay in your lane","Move into an open lane and follow the limit","Ignore and continue","Stop in lane"], c:1, e:"Leave the closed lane safely and comply with the displayed limit in an open lane."},
  {q:"You‚Äôre in a contraflow at roadworks on a motorway. Best practice:", img:"https://images.unsplash.com/photo-1472437774355-71ab6752b434?q=80&w=1200&auto=format&fit=crop", a:["Stay close to vehicle ahead","Keep to temporary limit and your lane","Use hard shoulder to pass","Frequent lane changes"], c:1, e:"Keep to the temporary limit and lane; lane discipline improves flow and safety."},
  {q:"Approaching a crossing with this sign (no pedestrians shown):", img:"https://upload.wikimedia.org/wikipedia/commons/thumb/9/9e/UK_traffic_sign_544.svg/200px-UK_traffic_sign_544.svg.png", a:["Pedestrians in road","Zebra crossing ahead","School crossing patrol","Only cyclists crossing"], c:1, e:"Zebra crossing ahead; be prepared to stop for pedestrians."},
  {q:"You see this on approach to a bend (chevrons):", img:"https://upload.wikimedia.org/wikipedia/commons/thumb/c/c5/UK_traffic_sign_515.svg/200px-UK_traffic_sign_515.svg.png", a:["Advisory speed limit","Sharp change of direction ‚Äî follow chevrons","Priority over oncoming","Dual carriageway begins"], c:1, e:"Chevron boards emphasise a sharp bend; reduce speed and follow direction."},
  {q:"This blue sign shows a bus and cycle in a lane. It means:", img:"https://upload.wikimedia.org/wikipedia/commons/thumb/8/80/UK_traffic_sign_958.svg/200px-UK_traffic_sign_958.svg.png", a:["Bus and cycle lane","Bus stop","Cycles prohibited","Parking only"], c:0, e:"Indicates a designated bus and cycle lane (check times on plates)."}
];
// Ensure exactly 50
while(QUESTIONS.length < 50) QUESTIONS.push(...QUESTIONS.slice(0, 50-QUESTIONS.length));

// ===== Utils =====
const shuffle = (a) => a.map(v=>[Math.random(),v]).sort((x,y)=>x[0]-y[0]).map(x=>x[1]);
const fmtTime = (s) => `${String(Math.floor(s/60)).padStart(2,'0')}:${String(s%60).padStart(2,'0')}`;

// ===== State =====
let order = shuffle([...Array(QUESTIONS.length).keys()]).slice(0, TOTAL);
let idx = 0;
let chosen = Array(TOTAL).fill(null); // stores original option index
let timeLeft = DURATION_SECONDS;
let finished = false;

// ===== Elements =====
const qNo = document.getElementById('qNo');
const qText = document.getElementById('qText');
const qImg = document.getElementById('qImg');
const answersEl = document.getElementById('answers');
const progressBar = document.getElementById('progressBar');
const review = document.getElementById('review');
const timerEl = document.getElementById('timer');
const app = document.getElementById('app');
const results = document.getElementById('results');
const summary = document.getElementById('summary');
const incorrectList = document.getElementById('incorrectList');
const fbShareBtn = document.getElementById('fbShare');
const copyShareBtn = document.getElementById('copyShare');
const saveImgBtn = document.getElementById('saveImg');
const shareCard = document.getElementById('shareCard');

// ===== Render =====
function updateProgress(){
  const answered = chosen.filter(v=>v!==null).length;
  progressBar.style.width = (answered/TOTAL*100)+'%';
}
function updateReview(){
  review.innerHTML = '';
  for(let i=0;i<TOTAL;i++){
    const b = document.createElement('button');
    b.textContent = i+1;
    if(chosen[i]!==null) b.classList.add('answered');
    b.onclick = ()=>loadQuestion(i);
    review.appendChild(b);
  }
}
function loadQuestion(i){
  idx = i;
  const qi = order[i];
  const q = QUESTIONS[qi];
  qNo.textContent = i+1;
  qText.textContent = q.q;
  qImg.src = q.img || "";
  // answers (shuffle display, store original indices)
  answersEl.innerHTML = '';
  const options = shuffle(q.a.map((text,orig)=>({text,orig})));
  options.forEach((opt,k)=>{
    const label = document.createElement('label');
    label.className = 'answer';
    const inp = document.createElement('input');
    inp.type = 'radio'; inp.name = 'q';
    inp.checked = (chosen[i]===opt.orig);
    inp.onchange = ()=>{ chosen[i]=opt.orig; updateProgress(); updateReview(); };
    const txt = document.createElement('div');
    const letter = String.fromCharCode(65+k);
    txt.innerHTML = `<strong>${letter}.</strong> ${opt.text}`;
    label.appendChild(inp); label.appendChild(txt);
    answersEl.appendChild(label);
  });
  document.getElementById('prevBtn').disabled = i===0;
  document.getElementById('nextBtn').disabled = i===TOTAL-1;
}
function score(){
  let s=0;
  for(let i=0;i<TOTAL;i++){
    const qi = order[i]; const q = QUESTIONS[qi];
    if(chosen[i]===q.c) s++;
  }
  return s;
}
function finish(){
  if(finished) return;
  finished = true;
  const s = score();
  const passed = s>=PASS;
  const taken = DURATION_SECONDS - timeLeft;

  app.classList.add('hidden');
  results.classList.remove('hidden');

  summary.innerHTML = `Score: <strong>${s}</strong> / ${TOTAL} ‚Äî ${passed?'<span style="color:var(--brand)">PASS</span>':'<span style="color:var(--danger)">FAIL</span>'}
  <br>Answered: ${chosen.filter(v=>v!==null).length} ¬∑ Time taken: ${fmtTime(taken)} ¬∑ Date: ${new Date().toLocaleDateString()}`;

  // Share card fill
  document.getElementById('shareDate').textContent = `Date: ${new Date().toLocaleDateString()}`;
  document.getElementById('shareTimeTaken').textContent = `Time taken: ${fmtTime(taken)}`;
  document.getElementById('shareScore').textContent = `Score: ${s}/${TOTAL}`;
  document.getElementById('shareOutcome').textContent = passed ? 'Outcome: PASS' : 'Outcome: FAIL';

  // Incorrect list
  incorrectList.innerHTML = '';
  for(let i=0;i<TOTAL;i++){
    const qi = order[i]; const q = QUESTIONS[qi];
    if(chosen[i]!==q.c){
      const li = document.createElement('li');
      const your = chosen[i]==null ? 'No answer' : q.a[chosen[i]];
      li.innerHTML = `<div class="inc-q">Q${i+1}. ${q.q}</div>
        ${q.img?`<img src="${q.img}" alt="Question image" class="qimg" style="max-width:220px">`:''}
        <div>Your answer: <em>${your}</em></div>
        <div class="inc-correct">Correct: <strong>${q.a[q.c]}</strong></div>
        <div class="inc-expl">Why: ${q.e||'‚Äî'}</div>`;
      incorrectList.appendChild(li);
    }
  }

  // Share buttons
  fbShareBtn.onclick = ()=>{
    const quote = `I just scored ${s}/${TOTAL} on the Yes Passed Mock Theory Test! üöóüíö\nYes Passed Driving Academy\nBuilt for Growth. Driven by Learning.`;
    const u = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(SHARE_URL)}&quote=${encodeURIComponent(quote)}`;
    window.open(u,'_blank','noopener,noreferrer,width=800,height=600');
  };
  copyShareBtn.onclick = async ()=>{
    const text = `üöó I scored ${s}/${TOTAL} on the Yes Passed Mock Theory Test!\nTry it: ${SHARE_URL}\n\nüíö Yes Passed Driving Academy\nBuilt for Growth. Driven by Learning.`;
    try{ await navigator.clipboard.writeText(text); alert('Result copied!'); }catch{ alert('Copy failed. Long-press and copy:\n\n'+text); }
  };
  saveImgBtn.onclick = async ()=>{
    if(typeof html2canvas==='undefined'){ alert('Snapshot tool not loaded.'); return; }
    const canvas = await html2canvas(shareCard, {backgroundColor:null, scale:2});
    const a = document.createElement('a');
    a.href = canvas.toDataURL('image/png');
    a.download = `yes-passed-result-${s}.png`;
    a.click();
  };
}

// ===== Timer =====
setInterval(()=>{
  if(finished) return;
  timeLeft--;
  if(timeLeft<=0){ timeLeft=0; finish(); return; }
  timerEl.textContent = fmtTime(timeLeft);
  if(timeLeft===5*60) timerEl.style.color = 'var(--accent)';
  if(timeLeft<=60) timerEl.style.color = 'var(--danger)';
},1000);

// ===== Init & Handlers =====
document.getElementById('prevBtn').onclick = ()=>{ if(idx>0) loadQuestion(idx-1); };
document.getElementById('nextBtn').onclick = ()=>{ if(idx<TOTAL-1) loadQuestion(idx+1); };
document.getElementById('submitBtn').onclick = ()=>{ if(confirm('Submit test now?')) finish(); };
document.getElementById('restart').onclick = ()=>location.reload();

function init(){
  updateProgress(); updateReview(); loadQuestion(0);
}
init();
</script>
</body>
</html>
